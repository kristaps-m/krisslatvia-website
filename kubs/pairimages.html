<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>krisslativa</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/mobileScreen.css">
    <body>
        <!-- <br><br><br><br> --><!-- 4 line breaks -->
        <script id="replace_with_navbar" src="../navbar/nav.js"></script><!--Nav bar script;go:NB/nav.html-->
        <!-- prevuis menu bar-->
    </body>
    </head>
  </head>
  <main>
    <div style="align-items: center; text-align: center;" id="divInMain">
      <h2>Pair Images trainer</h2>
      <p id="thePairImageLetters" style="display: inline-block">THE THING</p>
      <div style="white-space: nowrap">
        <input type="text" id="pairImagesValueInput" style="width: 18rem;">
        <button style="display: inline-block" onclick="changePairImagesLetters()" id="editButton">EDIT</button>
      </div>
      <p>Press any key to get random pair from all pairs.</p>
      <p>Or click button!</p>
      <h1 id="theRandomPair">...</h1>
      <button id="startBtn" onclick="getPairFromArray()" style="width: 8rem; height: 4rem; font-size: medium;">Get Letter Pair</button>
      <br>
      <br>
      <!-- <canvas id="myCanvas" style="border: solid black 1px; width: 100px; height: 100px;"></canvas> -->
    </div>
  </main> 
  <script src="../GAMES/Global Helper Classes/getRndInteger.js"></script>
  <script>
    const CANVAS = document.createElement('canvas');
    CANVAS.id = "myCanvas";
    CANVAS.style.border = "1px solid black";
    // const IMAGE_LETTERS = "abcde".toUpperCase(); // smaller string for testing
    let IMAGE_LETTERS = "abcdefghijklmnoprstuvzāē".toUpperCase();
    const PAIR_LETTER_LEN = IMAGE_LETTERS.length;
    const STEP = 10;
    CANVAS.width = PAIR_LETTER_LEN * STEP;
    CANVAS.height = PAIR_LETTER_LEN * STEP;
    let mainDiv = document.getElementById("divInMain");
    mainDiv.appendChild(CANVAS);
    const CTX = CANVAS.getContext("2d");
    let pairImagesArray = createPairImagesArray(IMAGE_LETTERS);

    const thePairImageLetters = document.getElementById("thePairImageLetters");
    thePairImageLetters.textContent = IMAGE_LETTERS;
    const pairImagesValueInput = document.getElementById("pairImagesValueInput");
    pairImagesValueInput.value = IMAGE_LETTERS;

    function changePairImagesLetters() {
      const isEditConfirmed = confirm("Are you sure?");
      if(isEditConfirmed){
        const pairImagesValueInput = document.getElementById("pairImagesValueInput");
        // console.log(pairImagesValueInput.value);
        IMAGE_LETTERS = pairImagesValueInput.value;
        pairImagesArray = createPairImagesArray(IMAGE_LETTERS);
        shuffledPairArray = shuffle(pairImagesArray);
        CANVAS.width = IMAGE_LETTERS.length * STEP;
        CANVAS.height = IMAGE_LETTERS.length * STEP;
        // Draw square by diagonal where pair letter is it self ("AA", "DD")
        for (let i = 0; i < IMAGE_LETTERS.length; i++) {
          CTX.fillRect(i*STEP,i*STEP, STEP, STEP);
        }
        const editButton = document.getElementById("editButton");
        editButton.textContent = "START OVER?"
      }
    }

    document.addEventListener("keyup", function(event) {
      getPairFromArray();
    })

    // Draw square by diagonal where pair letter is it self ("AA", "DD")
    for (let i = 0; i < PAIR_LETTER_LEN; i++) {
      CTX.fillRect(i*STEP,i*STEP, STEP, STEP);
    }

    function shuffle(array) {
      for (let i = array.length -1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]        
      }

      return array;
    }

    let shuffledPairArray = shuffle(pairImagesArray);
    // console.log(shuffledPairArray.length);

    function createPairImagesArray(letterString) {
      let result = [];
      for (let i = 0; i < letterString.length; i++) {
        for (let j = 0; j < letterString.length; j++) {
          if(i != j){
            result.push(`${letterString[i]}-${letterString[j]}::${i}-${j}`);
          }
        }
      }

      return result;
    }

    function getPairFromArray() {
      const displayPair = document.getElementById("theRandomPair");
      let thePairData;
      if(shuffledPairArray.length > 0){
        thePairData = shuffledPairArray.pop().split("::");
        const thePair = thePairData[0];
        const pair_I = parseInt(thePairData[1].split("-")[0]);
        const pair_J = parseInt(thePairData[1].split("-")[1]);
  
        CTX.fillRect(pair_I*STEP,pair_J*STEP,STEP,STEP);
        displayPair.textContent = thePair;
        // console.log(shuffledPairArray.length);
      }else{
        alert("DONE");
        displayPair.textContent = "YOU ARE DONE";
      }
    }

    function getPair(params) {
      const displayPair = document.getElementById("theRandomPair");
      const r1 = IMAGE_LETTERS[getRndInteger(0,PAIR_LETTER_LEN-1)];
      const r2 = IMAGE_LETTERS[getRndInteger(0,PAIR_LETTER_LEN-1)];
      if(r1 != r2){
        displayPair.textContent = `${r1}-${r2}`;
      }      
    }
  </script>
</html>