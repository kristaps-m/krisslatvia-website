<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>krisslativa</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/mobileScreen.css">
    <body>
        <!-- <br><br><br><br> --><!-- 4 line breaks -->
        <script id="replace_with_navbar" src="../navbar/nav.js"></script><!--Nav bar script;go:NB/nav.html-->
        <!-- prevuis menu bar-->
    </body>
    <style>
      p{
        font-size: smaller;
      }
    </style>
    </head>
  </head>
  <main>
    <div style="align-items: center; text-align: center; margin: 1px;" id="divInMain">
      <h2 style="margin: 1px;">Pair Images trainer</h2>
      <p id="thePairImageLetters" style="margin: 1px;">THE THING</p>
      <p id="thePairImageLetters_vert" style="margin: 1px;">THE THING</p>
      <div style="white-space: nowrap; margin: 1px;">
        <p>Horizontal</p>
        <input type="text" id="pairImagesValueInput" style="width: 18rem;">
      </div>
      <div style="white-space: nowrap">
        <p>Vertical</p>
        <input type="text" id="pairImagesValueInput_vert" style="width: 18rem;">
      </div>
      <br>
      <button style="display: inline-block" onclick="changePairImagesLetters()" id="editButton">EDIT</button>
      <p style="margin: 1px;">Press any key to get random pair from all pairs.</p>
      <p style="margin: 1px;">Or click button!</p>
      <p style="margin: 1px;">Feel free to edit training range.</p>
      <p style="margin: 1px;">Vertical EFGH / Horizontal A..Z will help you train all leter pairs for letters E,F,G and H</p>
      <h1 id="theRandomPair" style="margin: 1px;">---> ... <---</h1>
      <button id="startBtn" onclick="getPairFromArray()" style="width: 8rem; height: 4rem; font-size: medium;">Get Letter Pair</button>
      <br>
      <br>
    </div>
  </main> 
  <script src="../GAMES/Global Helper Classes/getRndInteger.js"></script>
  <script>
    const CANVAS = document.createElement('canvas');
    CANVAS.id = "myCanvas";
    CANVAS.style.border = "1px solid black";
    // const IMAGE_LETTERS = "abcde".toUpperCase(); // smaller string for testing
    let IMAGE_LETTERS = "abcdefghijklmnoprstuvzāē".toUpperCase();
    let IMAGE_LETTERS_vert = "abcdefghijklmnoprstuvzāē".toUpperCase();
    // const PAIR_LETTER_LEN = IMAGE_LETTERS.length;
    const STEP = 10;
    CANVAS.width = IMAGE_LETTERS.length * STEP;
    CANVAS.height = IMAGE_LETTERS_vert.length * STEP;
    let mainDiv = document.getElementById("divInMain");
    mainDiv.appendChild(CANVAS);
    const CTX = CANVAS.getContext("2d");
    let pairImagesArray = createPairImagesArray(IMAGE_LETTERS, IMAGE_LETTERS_vert);

    const thePairImageLetters = document.getElementById("thePairImageLetters");
    thePairImageLetters.textContent = IMAGE_LETTERS;
    const thePairImageLetters_vert = document.getElementById("thePairImageLetters_vert");
    thePairImageLetters_vert.textContent = IMAGE_LETTERS_vert;
    const pairImagesValueInput = document.getElementById("pairImagesValueInput");
    const pairImagesValueInput_vert = document.getElementById("pairImagesValueInput_vert");
    pairImagesValueInput.value = IMAGE_LETTERS;
    pairImagesValueInput_vert.value = IMAGE_LETTERS_vert;

    function changePairImagesLetters() {
      const isEditConfirmed = confirm("Are you sure?");
      if(isEditConfirmed){
        const pairImagesValueInput = document.getElementById("pairImagesValueInput");
        const pairImagesValueInput_vert = document.getElementById("pairImagesValueInput_vert");
        // console.log(pairImagesValueInput.value);
        IMAGE_LETTERS = pairImagesValueInput.value;
        IMAGE_LETTERS_vert = pairImagesValueInput_vert.value;
        pairImagesArray = createPairImagesArray(IMAGE_LETTERS, IMAGE_LETTERS_vert);
        shuffledPairArray = shuffle(pairImagesArray);
        CANVAS.width = IMAGE_LETTERS.length * STEP;
        CANVAS.height = IMAGE_LETTERS_vert.length * STEP;
        drawSquareByDiagonalWherePairLetterIsItSelf();
        const editButton = document.getElementById("editButton");
        editButton.textContent = "START OVER?"
      }
    }

    document.addEventListener("keyup", function(event) {
      getPairFromArray();
    })

    drawSquareByDiagonalWherePairLetterIsItSelf();

    function drawSquareByDiagonalWherePairLetterIsItSelf() {
      // Draw square by diagonal where pair letter is it self ("AA", "DD")
      for (let i = 0; i < IMAGE_LETTERS.length; i++) {
        for (let j = 0; j < IMAGE_LETTERS_vert.length; j++) {
          if(i == j){
            CTX.fillRect(i*STEP,j*STEP, STEP, STEP);
          }
        }
      }
      // Draw letters horizontaly and verticaly in canvas
      CTX.fillStyle = "red";
      for (let i = 0; i < IMAGE_LETTERS.length; i++) {
        CTX.fillText(IMAGE_LETTERS[i], i*STEP, STEP);
      }

      for (let j = 0; j < IMAGE_LETTERS_vert.length; j++) {
        CTX.fillText(IMAGE_LETTERS_vert[j], STEP/2, j*STEP + STEP/2);
      }
      CTX.fillStyle = "black";
    }

    function shuffle(array) {
      for (let i = array.length -1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]        
      }

      return array;
    }

    let shuffledPairArray = shuffle(pairImagesArray);
    // console.log(shuffledPairArray.length);

    function createPairImagesArray(letterString, letterString_vert) {
      let result = [];
      for (let i = 0; i < letterString.length; i++) {
        for (let j = 0; j < letterString_vert.length; j++) {
          if(i != j){
            result.push(`${letterString[i]}-${letterString_vert[j]}::${i}-${j}`);
          }
        }
      }

      return result;
    }

    function getPairFromArray() {
      const displayPair = document.getElementById("theRandomPair");
      let thePairData;
      if(shuffledPairArray.length > 0){
        thePairData = shuffledPairArray.pop().split("::");
        const thePair = thePairData[0];
        const pair_I = parseInt(thePairData[1].split("-")[0]);
        const pair_J = parseInt(thePairData[1].split("-")[1]);
  
        CTX.fillRect(pair_I*STEP,pair_J*STEP,STEP,STEP);
        displayPair.textContent = thePair.toUpperCase();
        // console.log(shuffledPairArray.length);
      }else{
        alert("DONE");
        displayPair.textContent = "YOU ARE DONE";
      }
    }

    function getPair(params) {
      const displayPair = document.getElementById("theRandomPair");
      const r1 = IMAGE_LETTERS[getRndInteger(0,IMAGE_LETTERS.length-1)];
      const r2 = IMAGE_LETTERS_vert[getRndInteger(0,IMAGE_LETTERS_vert.length-1)];
      if(r1 != r2){
        displayPair.textContent = `${r1}-${r2}`;
      }      
    }
  </script>
</html>